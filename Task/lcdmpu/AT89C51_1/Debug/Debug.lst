
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	..\main.asm
	Object File:	Debug.HEX
	List File:	Debug.lst



 Line  I  Addr  Code            Source

    1:				;====================================================================
    2:				; main.asm file generated by new project wizard
    3:				;
    4:				; created:   thu apr 25 2024
    5:				; processor: 80c31
    6:				; compiler:  asem-51 (proteus)
    7:				;====================================================================
    8:
    9:				$nomod51
   10:				$include (8051.mcu)
   11: 1			;   8051 processor definition file
   12: 1			;   ==============================
   13: 1
   14: 1	N	 80	P0	DATA	080H
   15: 1	N	 81	SP	DATA	081H
   16: 1	N	 82	DPL	DATA	082H
   17: 1	N	 83	DPH	DATA	083H
   18: 1	N	 87	PCON	DATA	087H
   19: 1	N	 88	TCON	DATA	088H
   20: 1	N	 89	TMOD	DATA	089H
   21: 1	N	 8A	TL0	DATA	08AH
   22: 1	N	 8B	TL1	DATA	08BH
   23: 1	N	 8C	TH0	DATA	08CH
   24: 1	N	 8D	TH1	DATA	08DH
   25: 1	N	 90	P1	DATA	090H
   26: 1	N	 98	SCON	DATA	098H
   27: 1	N	 99	SBUF	DATA	099H
   28: 1	N	 A0	P2	DATA	0A0H
   29: 1	N	 A8	IE	DATA	0A8H
   30: 1	N	 B0	P3	DATA	0B0H
   31: 1	N	 B8	IP	DATA	0B8H
   32: 1	N	 D0	PSW	DATA	0D0H
   33: 1	N	 E0	ACC	DATA	0E0H
   34: 1	N	 F0	B	DATA	0F0H
   35: 1
   36: 1	N	 88	IT0	BIT	088H
   37: 1	N	 89	IE0	BIT	089H
   38: 1	N	 8A	IT1	BIT	08AH
   39: 1	N	 8B	IE1	BIT	08BH
   40: 1	N	 8C	TR0	BIT	08CH
   41: 1	N	 8D	TF0	BIT	08DH
   42: 1	N	 8E	TR1	BIT	08EH
   43: 1	N	 8F	TF1	BIT	08FH

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44: 1	N	 98	RI	BIT	098H
   45: 1	N	 99	TI	BIT	099H
   46: 1	N	 9A	RB8	BIT	09AH
   47: 1	N	 9B	TB8	BIT	09BH
   48: 1	N	 9C	REN	BIT	09CH
   49: 1	N	 9D	SM2	BIT	09DH
   50: 1	N	 9E	SM1	BIT	09EH
   51: 1	N	 9F	SM0	BIT	09FH
   52: 1	N	 A8	EX0	BIT	0A8H
   53: 1	N	 A9	ET0	BIT	0A9H
   54: 1	N	 AA	EX1	BIT	0AAH
   55: 1	N	 AB	ET1	BIT	0ABH
   56: 1	N	 AC	ES	BIT	0ACH
   57: 1	N	 AF	EA	BIT	0AFH
   58: 1	N	 B0	RXD	BIT	0B0H
   59: 1	N	 B1	TXD	BIT	0B1H
   60: 1	N	 B2	INT0	BIT	0B2H
   61: 1	N	 B3	INT1	BIT	0B3H
   62: 1	N	 B4	T0	BIT	0B4H
   63: 1	N	 B5	T1	BIT	0B5H
   64: 1	N	 B6	WR	BIT	0B6H
   65: 1	N	 B7	RD	BIT	0B7H
   66: 1	N	 B8	PX0	BIT	0B8H
   67: 1	N	 B9	PT0	BIT	0B9H
   68: 1	N	 BA	PX1	BIT	0BAH
   69: 1	N	 BB	PT1	BIT	0BBH
   70: 1	N	 BC	PS	BIT	0BCH
   71: 1	N	 D0	P	BIT	0D0H
   72: 1	N	 D2	OV	BIT	0D2H
   73: 1	N	 D3	RS0	BIT	0D3H
   74: 1	N	 D4	RS1	BIT	0D4H
   75: 1	N	 D5	F0	BIT	0D5H
   76: 1	N	 D6	AC	BIT	0D6H
   77: 1	N	 D7	CY	BIT	0D7H
   78: 1
   79: 1	N      0000	RESET	CODE	000H
   80: 1	N      0003	EXTI0	CODE	003H
   81: 1	N      000B	TIMER0	CODE	00BH
   82: 1	N      0013	EXTI1	CODE	013H
   83: 1	N      001B	TIMER1	CODE	01BH
   84: 1	N      0023	SINT	CODE	023H
   85:
   86:				;====================================================================
   87:				; definitions
   88:				;====================================================================
   89:
   90:				;====================================================================
   91:				; variables
   92:				;====================================================================
   93:
   94:				;====================================================================
   95:				; reset and interrupt vectors
   96:				;====================================================================
   97:
   98:				      ; reset vector
   99:		N      0000	      org   0000h

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100:	  0000	02 01 00	      jmp   start
  101:
  102:				;====================================================================
  103:				; code segment
  104:				;====================================================================
  105:
  106:		N      0100	      org   0100h
  107:
  108:	  0100			start:
  109:	  0100	12 01 BB	    lcall i2c_init
  110:	  0103	12 02 11	    call lcd_init
  111:	  0106	12 01 C9	    lcall i2c_start
  112:	  0109	74 D0		    mov a, #11010000b
  113:	  010B	31 D9		    acall i2c_write
  114:	  010D	74 6B		    mov a, #6bh
  115:	  010F	31 D9		    acall i2c_write
  116:	  0111	74 00		    mov a, #00h
  117:	  0113	31 D9		    acall i2c_write
  118:	  0115	31 D0		    acall i2c_stop
  119:
  120:	  0117	12 01 BB	    lcall i2c_init
  121:	  011A	12 01 C9	    lcall i2c_start
  122:	  011D	74 D0		    mov a, #11010000b
  123:	  011F	31 D9		    acall i2c_write
  124:	  0121	74 1B		    mov a, #1bh
  125:	  0123	31 D9		    acall i2c_write
  126:	  0125	74 00		    mov a, #00h
  127:	  0127	31 D9		    acall i2c_write
  128:	  0129	31 D0		    acall i2c_stop
  129:
  130:
  131:	  012B			loop:
  132:				    ; Gyro X
  133:	  012B	12 01 BB	    lcall i2c_init
  134:	  012E	12 01 C9	    lcall i2c_start
  135:	  0131	74 D0		    mov a, #11010000b
  136:	  0133	31 D9		    acall i2c_write
  137:	  0135	74 43		    mov a, #43h
  138:	  0137	31 D9		    acall i2c_write
  139:	  0139	12 01 C9	    lcall i2c_start
  140:	  013C	74 D1		    mov a, #11010001b
  141:	  013E	31 D9		    acall i2c_write
  142:	  0140	51 01		    acall i2c_read
  143:	  0142	F8		    mov r0, a
  144:	  0143	31 F8		    acall i2c_nack
  145:	  0145	31 D0		    acall i2c_stop
  146:
  147:	  0147	74 80		    mov a, #80h
  148:	  0149	12 02 37	    call lcd_set_cursor
  149:
  150:	  014C	74 47		    mov a, #'G'
  151:	  014E	12 02 48	    call lcd_send_data
  152:	  0151	74 79		    mov a, #'y'
  153:	  0153	12 02 48	    call lcd_send_data
  154:	  0156	74 72		    mov a, #'r'
  155:	  0158	12 02 48	    call lcd_send_data

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:	  015B	74 6F		    mov a, #'o'
  157:	  015D	12 02 48	    call lcd_send_data
  158:	  0160	74 58		    mov a, #'X'
  159:	  0162	12 02 48	    call lcd_send_data
  160:	  0165	74 3A		    mov a, #':'
  161:	  0167	12 02 48	    call lcd_send_data
  162:
  163:	  016A	E8		    mov a, r0
  164:	  016B	12 02 59	    call lcd_print
  165:
  166:				    ; Accel X
  167:	  016E	12 01 BB	    lcall i2c_init
  168:	  0171	12 01 C9	    lcall i2c_start
  169:	  0174	74 D0		    mov a, #11010000b
  170:	  0176	31 D9		    acall i2c_write
  171:	  0178	74 3B		    mov a, #3bh
  172:	  017A	31 D9		    acall i2c_write
  173:	  017C	12 01 C9	    lcall i2c_start
  174:	  017F	74 D1		    mov a, #11010001b
  175:	  0181	31 D9		    acall i2c_write
  176:	  0183	51 01		    acall i2c_read
  177:	  0185	F8		    mov r0, a
  178:	  0186	31 F8		    acall i2c_nack
  179:	  0188	31 D0		    acall i2c_stop
  180:
  181:	  018A	74 C0		    mov a, #0C0h
  182:	  018C	12 02 37	    call lcd_set_cursor
  183:
  184:	  018F	74 41		    mov a, #'A'
  185:	  0191	12 02 48	    call lcd_send_data
  186:	  0194	74 63		    mov a, #'c'
  187:	  0196	12 02 48	    call lcd_send_data
  188:	  0199	74 63		    mov a, #'c'
  189:	  019B	12 02 48	    call lcd_send_data
  190:	  019E	74 65		    mov a, #'e'
  191:	  01A0	12 02 48	    call lcd_send_data
  192:	  01A3	74 6C		    mov a, #'l'
  193:	  01A5	12 02 48	    call lcd_send_data
  194:	  01A8	74 58		    mov a, #'X'
  195:	  01AA	12 02 48	    call lcd_send_data
  196:	  01AD	74 3A		    mov a, #':'
  197:	  01AF	12 02 48	    call lcd_send_data
  198:
  199:	  01B2	E8		    mov a, r0
  200:	  01B3	12 02 59	    call lcd_print
  201:
  202:	  01B6	12 02 7D	    call delay
  203:
  204:	  01B9	21 2B		    jmp loop
  205:
  206:	  01BB			i2c_init:
  207:	  01BB	D2 92		    setb p1.2
  208:	  01BD	D2 93		    setb p1.3
  209:	  01BF	22		    ret
  210:
  211:	  01C0			i2c_reset:

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  212:	  01C0	C2 93		    clr p1.3
  213:	  01C2	D2 92		    setb p1.2
  214:	  01C4	D2 93		    setb p1.3
  215:	  01C6	C2 92		    clr p1.2
  216:	  01C8	22		    ret
  217:
  218:	  01C9			i2c_start:
  219:	  01C9	D2 93		    setb p1.3
  220:	  01CB	C2 92		    clr p1.2
  221:	  01CD	C2 93		    clr p1.3
  222:	  01CF	22		    ret
  223:
  224:	  01D0			i2c_stop:
  225:	  01D0	C2 93		    clr p1.3
  226:	  01D2	C2 92		    clr p1.2
  227:	  01D4	D2 93		    setb p1.3
  228:	  01D6	D2 92		    setb p1.2
  229:	  01D8	22		    ret
  230:
  231:	  01D9			i2c_write:
  232:	  01D9	7F 08		    mov r7, #08
  233:	  01DB			i2c_write_loop:
  234:	  01DB	C2 93		    clr p1.3
  235:	  01DD	33		    rlc a
  236:	  01DE	92 92		    mov p1.2, c
  237:	  01E0	D2 93		    setb p1.3
  238:	  01E2	DF F7		    djnz r7, i2c_write_loop
  239:	  01E4	C2 93		    clr p1.3
  240:	  01E6	D2 92		    setb p1.2
  241:	  01E8	D2 93		    setb p1.3
  242:	  01EA	A2 92		    mov c, p1.2
  243:	  01EC	C2 93		    clr p1.3
  244:	  01EE	22		    ret
  245:
  246:	  01EF			i2c_ack:
  247:	  01EF	C2 92		    clr p1.2
  248:	  01F1	D2 93		    setb p1.3
  249:	  01F3	C2 93		    clr p1.3
  250:	  01F5	D2 92		    setb p1.2
  251:	  01F7	22		    ret
  252:
  253:	  01F8			i2c_nack:
  254:	  01F8	D2 92		    setb p1.2
  255:	  01FA	D2 93		    setb p1.3
  256:	  01FC	C2 93		    clr p1.3
  257:	  01FE	D2 93		    setb p1.3
  258:	  0200	22		    ret
  259:
  260:	  0201			i2c_read:
  261:	  0201	7F 08		    mov r7, #08
  262:	  0203			i2c_read_loop:
  263:	  0203	C2 93		    clr p1.3
  264:	  0205	D2 93		    setb p1.3
  265:	  0207	A2 92		    mov c, p1.2
  266:	  0209	33		    rlc a
  267:	  020A	DF F7		    djnz r7, i2c_read_loop

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



 Line  I  Addr  Code            Source

  268:	  020C	C2 93		    clr p1.3
  269:	  020E	D2 92		    setb p1.2
  270:	  0210	22		    ret
  271:
  272:	  0211			lcd_init:
  273:	  0211	74 38		    mov a, #00111000b
  274:	  0213	12 02 26	    call send_inst
  275:	  0216	74 06		    mov a, #00000110b
  276:	  0218	12 02 26	    call send_inst
  277:	  021B	74 0C		    mov a, #00001100b
  278:	  021D	12 02 26	    call send_inst
  279:	  0220	74 01		    mov a, #00000001b
  280:	  0222	12 02 26	    call send_inst
  281:	  0225	22		    ret
  282:
  283:	  0226			send_inst:
  284:	  0226	C2 90		    clr p1.0
  285:	  0228	D2 91		    setb p1.1
  286:	  022A	F5 A0		    mov p2, a
  287:	  022C	12 02 7D	    call delay
  288:	  022F	C2 91		    clr p1.1
  289:	  0231	D2 91		    setb p1.1
  290:	  0233	12 02 7D	    call delay
  291:	  0236	22		    ret
  292:
  293:	  0237			lcd_set_cursor:
  294:	  0237	C2 90		    clr p1.0
  295:	  0239	D2 91		    setb p1.1
  296:	  023B	F5 A0		    mov p2, a
  297:	  023D	12 02 7D	    call delay
  298:	  0240	C2 91		    clr p1.1
  299:	  0242	D2 91		    setb p1.1
  300:	  0244	12 02 7D	    call delay
  301:	  0247	22		    ret
  302:
  303:	  0248			lcd_send_data:
  304:	  0248	D2 90		    setb p1.0
  305:	  024A	D2 91		    setb p1.1
  306:	  024C	F5 A0		    mov p2, a
  307:	  024E	12 02 7D	    call delay
  308:	  0251	C2 91		    clr p1.1
  309:	  0253	D2 91		    setb p1.1
  310:	  0255	12 02 7D	    call delay
  311:	  0258	22		    ret
  312:
  313:	  0259			lcd_print:
  314:	  0259	75 F0 64	    mov b, #64h
  315:	  025C	84		    div ab
  316:	  025D	F9		    mov r1, a
  317:	  025E	E5 F0		    mov a, b
  318:
  319:	  0260	75 F0 0A	    mov b, #0ah
  320:	  0263	84		    div ab
  321:	  0264	FA		    mov r2, a
  322:	  0265	AB F0		    mov r3, b
  323:

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



 Line  I  Addr  Code            Source

  324:	  0267	E9		    mov a, r1
  325:	  0268	24 30		    add a, #30h
  326:	  026A	F9		    mov r1, a
  327:
  328:	  026B	EA		    mov a, r2
  329:	  026C	24 30		    add a, #30h
  330:	  026E	FA		    mov r2, a
  331:
  332:	  026F	EB		    mov a, r3
  333:	  0270	24 30		    add a, #30h
  334:	  0272	FB		    mov r3, a
  335:
  336:	  0273	E9		    mov a, r1
  337:	  0274	51 48		    call lcd_send_data
  338:
  339:	  0276	EA		    mov a, r2
  340:	  0277	51 48		    call lcd_send_data
  341:
  342:	  0279	EB		    mov a, r3
  343:	  027A	51 48		    call lcd_send_data
  344:
  345:	  027C	22		    ret
  346:
  347:	  027D			delay:
  348:	  027D	7F 01		    mov r7, #01
  349:	  027F			delay_loop1:
  350:	  027F	7E 37		    mov r6, #055
  351:	  0281			delay_loop2:
  352:	  0281	7D 37		    mov r5, #055
  353:	  0283			delay_loop3:
  354:	  0283	1D		    dec r5
  355:	  0284	00		    nop
  356:	  0285	BD 00 FB	    cjne r5, #00, delay_loop3
  357:	  0288	1E		    dec r6
  358:	  0289	BE 00 F5	    cjne r6, #00, delay_loop2
  359:	  028C	1F		    dec r7
  360:	  028D	BF 00 EF	    cjne r7, #00, delay_loop1
  361:	  0290	22		    ret
  362:
  363:
  364:				;====================================================================
  365:				      end





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6	  76
ACC				  DATA	      E0	  33
B				  DATA	      F0	  34
CY				  BIT	      D7	  77
DELAY				  CODE	    027D	 347
DELAY_LOOP1			  CODE	    027F	 349
DELAY_LOOP2			  CODE	    0281	 351
DELAY_LOOP3			  CODE	    0283	 353
DPH				  DATA	      83	  17
DPL				  DATA	      82	  16
EA				  BIT	      AF	  57
ES				  BIT	      AC	  56
ET0				  BIT	      A9	  53
ET1				  BIT	      AB	  55
EX0				  BIT	      A8	  52
EX1				  BIT	      AA	  54
EXTI0				  CODE	    0003	  80
EXTI1				  CODE	    0013	  82
F0				  BIT	      D5	  75
I2C_ACK				  CODE	    01EF	 246
I2C_INIT			  CODE	    01BB	 206
I2C_NACK			  CODE	    01F8	 253
I2C_READ			  CODE	    0201	 260
I2C_READ_LOOP			  CODE	    0203	 262
I2C_RESET			  CODE	    01C0	 211
I2C_START			  CODE	    01C9	 218
I2C_STOP			  CODE	    01D0	 224
I2C_WRITE			  CODE	    01D9	 231
I2C_WRITE_LOOP			  CODE	    01DB	 233
IE				  DATA	      A8	  29
IE0				  BIT	      89	  37
IE1				  BIT	      8B	  39
INT0				  BIT	      B2	  60
INT1				  BIT	      B3	  61
IP				  DATA	      B8	  31
IT0				  BIT	      88	  36
IT1				  BIT	      8A	  38
LCD_INIT			  CODE	    0211	 272
LCD_PRINT			  CODE	    0259	 313
LCD_SEND_DATA			  CODE	    0248	 303
LCD_SET_CURSOR			  CODE	    0237	 293
LOOP				  CODE	    012B	 131
OV				  BIT	      D2	  72
P				  BIT	      D0	  71
P0				  DATA	      80	  14
P1				  DATA	      90	  25
P2				  DATA	      A0	  28
P3				  DATA	      B0	  30

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 9



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PCON				  DATA	      87	  18
PS				  BIT	      BC	  70
PSW				  DATA	      D0	  32
PT0				  BIT	      B9	  67
PT1				  BIT	      BB	  69
PX0				  BIT	      B8	  66
PX1				  BIT	      BA	  68
RB8				  BIT	      9A	  46
RD				  BIT	      B7	  65
REN				  BIT	      9C	  48
RESET				  CODE	    0000	  79
RI				  BIT	      98	  44
RS0				  BIT	      D3	  73
RS1				  BIT	      D4	  74
RXD				  BIT	      B0	  58
SBUF				  DATA	      99	  27
SCON				  DATA	      98	  26
SEND_INST			  CODE	    0226	 283
SINT				  CODE	    0023	  84
SM0				  BIT	      9F	  51
SM1				  BIT	      9E	  50
SM2				  BIT	      9D	  49
SP				  DATA	      81	  15
START				  CODE	    0100	 108
T0				  BIT	      B4	  62
T1				  BIT	      B5	  63
TB8				  BIT	      9B	  47
TCON				  DATA	      88	  19
TF0				  BIT	      8D	  41
TF1				  BIT	      8F	  43
TH0				  DATA	      8C	  23
TH1				  DATA	      8D	  24
TI				  BIT	      99	  45
TIMER0				  CODE	    000B	  81
TIMER1				  CODE	    001B	  83
TL0				  DATA	      8A	  21
TL1				  DATA	      8B	  22
TMOD				  DATA	      89	  20
TR0				  BIT	      8C	  40
TR1				  BIT	      8E	  42
TXD				  BIT	      B1	  59
WR				  BIT	      B6	  64
